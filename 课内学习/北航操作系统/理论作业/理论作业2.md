1． 动态内存分配需要对内存分区进行管理，一般使用位图和空闲链表两种方法。128MB的内存以n字节为单元分配，对于链表，假设内存中数据段和空闲区交替排列，长度均为64KB。并假设链表中的每个节点需要记录32位的内存地址信息、16位长度信息和16位下一节点域信息。这两种方法分别需要多少字节的存储空间？哪种方法更好？ 

**答：位图需要128M/n bit即16/n MB的空间，链表需要128MB/64KB*64 bit即16KB的空间**

**当n>1K的时候，位图更好，当n<1K的时候，链表更好。**

2． 在一个交换系统中，按内存地址排列的空闲区大小是: 10KB、4KB、20KB、18KB、7KB、9KB、12KB和15KB。对于连续的段请求：12KB、10KB、9KB。使用FirstFit、BestFit、WorstFit和NextFit将找出哪些空闲区？ 

**答：**

- **firstFit：20KB、10KB、18KB**
- **BesFit：12KB、10KB、9KB**
- **WorstFit：20KB、18KB、15KB**
- **NextFit：20KB、18KB、9KB**

3． 解释逻辑地址、物理地址、地址映射，并举例说明。

**逻辑地址是程序使用的抽象地址，物理地址是内存中低真实地址。地址映射就是将逻辑地址映射到物理地址当中。不同的进程可以使用相同的逻辑地址，但是映射到物理地址当中并不相同**

4.解释页式（段式）存储管理中为什么要设置页（段）表和快表，简述页式（段式）地址转换过程。

**答：分页是为了解决内存不够用的问题，为了使虚拟地址空间比真实的内存空间更大，将程序分成多个页，不是所有的页都在内存中才能运行程序，需要的时候将页从磁盘加载到内存中，不需要的时候则存储在磁盘里。页表是为了将虚拟页号转换成内存中对应的页框号。快表是为了减少访存的次数。**

**页式地址转换过程：虚拟地址被分成虚拟页号和偏移量，虚拟页号作为页表的索引，找到改虚拟页面对应的页表项，由页表项找到页框号，把页框号拼接到偏移量的高位端，形成送往内存的物理地址。**

5． 叙述缺页中断的处理流程。

**答：**

- **硬件陷入内核，在堆栈中保存程序计数器**
- **启动一个汇编代码例程保存通用寄存器和其他易失寄存器**
- **当操作系统发现一个缺页中断的时候，尝试发现需要哪个虚拟页面。通常一个硬件寄存器包含了这一信息，如果没有的话，操作系统必须检索程序计数器，取出这条指令，用软件分析这条指令，看看它在缺页中断时正在做什么**
- **一但知道了发生缺页中断的虚拟地址，操作系统检查这个地址是否有效，并检查存取与保护是否一致。如果不一致，向进程发出一个信号或杀掉改进程。如果地址有效且没有保护错误发生，系统则检查是否有空闲页框。如果没有空闲页框，执行页面置换算法寻找一个页面来淘汰。**
- **如果选择的页面脏了，安排该页写回磁盘，并发生一次上下文切换，挂起产生缺页中断的进程，让其它进程运行直至磁盘传输结束。无论如何，该页框被标记为忙，以免因为其它原因被其它进程占用**
- **一但页框干净后，草最新呕吐那个查找所需页面在磁盘上的地址，通过磁盘操作将其装入。该页面正在被装入时，产生缺页中断的进程仍然被挂起，并且如果由其它可运行的用户进程，则选择另一个用户进程运行。**
- **当磁盘中断发生时，表明该页面已经被装入，页表已经更新可以反映它的位置，页框也被标记为正常状态**
- **回复发生缺页中断指令以前的状态，程序计数器重新指向这条指令**
- **调度引发缺页中断的进程**
- **例程恢复寄存器和其他状态信息**

6． 假设一个机器有38位的虚拟地址和32位的物理地址。 

(1) 与一级页表相比，多级页表的主要优点是什么？ 

(2) 如果使用二级页表，页面大小为16KB，每个页表项有4个字节。应该为虚拟地址中的第一级和第二级页表域各分配多少位？ 

**答：**

- **（1）不用把全部页表一直保存在内存中**

- **（2）38位虚拟地址，页内偏移占14位，剩24位，各分配12位**

7． 假设页面的访问存在一定的周期性循环，但周期之间会随机出现一些页面的访问。例如：0,1,2…,511,431,0,1,2…511,332,0,1,2,…,511等。请思考： 

(1) LRU、FIFO和Clock算法的效果如何？ 

(2) 如果有500个页框，能否设计一个优于LRU、FIFO和Clock的算法？ 

**答：**

**（1）**

- **LRU，访问周期循环的页面会很快，但是周期循环的页面很容易始终占用内存，如果占用过多，访问循环后期页面，随机页面的时候容易出现缺页中断，降低速度**
- **FIFO，非常慢，基本上会一直缺页中断**
- **Clock算法，访问周期循环很快，访问随机页面很慢**

**（2）**

**设计一个基于访问模式的算法**

- **检测周期性循环**

  **如果检测到周期性循环，记录周期性页面**

- **保护周期性页面**

  **优先淘汰非周期性页面**

- **处理随机插入页面**

  **对于随机插入的页面，使用LRU或Clock淘汰**

  **如果随机插入页面访问频率较高，可以提升为周期性页面**

  

8． 一个交换系统通过紧缩技术来清理碎片。如果内存碎片和数据区域是随机分配的。而且假设读写32位内存字需要10nsec. 那么如果紧缩128MB的内存需要多久？简单起见，假设第0个字是碎片的一部分而最高位的字包含了有效的数据。

**答：随机分配即完全碎片化，一半的字都需要重新读写，所以共需要128M/2*（10+10）=1280Mnsec**

