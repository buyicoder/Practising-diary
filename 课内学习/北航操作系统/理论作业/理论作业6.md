1.

### 磁盘调度算法寻道时间分析

**初始条件：**

- 磁头初始位置：柱面 15
- 磁盘请求序列：10, 35, 20, 70, 2, 3, 38
- 寻道时间：每移动一个柱面需 5ms
- 最大柱面号：85
- 对于 SCAN 和 CSCAN，磁头初始方向为向大柱面号移动。

------

### （1）先来先服务（FCFS）

**调度顺序：** 按请求到达顺序处理（10 → 35 → 20 → 70 → 2 → 3 → 38）。
**移动柱面数：**

| 从 → 到                                      | 移动距离 |
| :------------------------------------------- | :------- |
| 15 → 10                                      | 5        |
| 10 → 35                                      | 25       |
| 35 → 20                                      | 15       |
| 20 → 70                                      | 50       |
| 70 → 2                                       | 68       |
| 2 → 3                                        | 1        |
| 3 → 38                                       | 35       |
| **总寻道距离：** 5+25+15+50+68+1+35=199 柱面 |          |
| **寻道时间：** 199×5=995ms                   |          |

------

### （2）最短寻道时间优先（SSTF）

**调度顺序：** 每次选择距离当前磁头位置最近的请求。
**步骤：**

1. 初始位置：15，最近请求为 10 或 20（选 20，距离 5）。
2. 位置 20，最近请求为 10（距离 10）或 35（距离 15），选 10。
3. 位置 10，最近请求为 3（距离 7）或 2（距离 8），选 3。
4. 位置 3，最近请求为 2（距离 1）。
5. 位置 2，剩余请求为 35, 38, 70，最近为 35（距离 33）。
6. 位置 35，最近为 38（距离 3）。
7. 位置 38，最后请求 70（距离 32）。

**移动柱面数：**

| 顺序                                      | 从 → 到 | 距离 |
| :---------------------------------------- | :------ | :--- |
| 1                                         | 15 → 20 | 5    |
| 2                                         | 20 → 10 | 10   |
| 3                                         | 10 → 3  | 7    |
| 4                                         | 3 → 2   | 1    |
| 5                                         | 2 → 35  | 33   |
| 6                                         | 35 → 38 | 3    |
| 7                                         | 38 → 70 | 32   |
| **总寻道距离：** 5+10+7+1+33+3+32=91 柱面 |         |      |
| **寻道时间：** 91×5=455ms                 |         |      |

------

### （3）SCAN 算法（电梯算法）

**调度顺序：** 磁头向大柱面号移动到底（85），再反向扫描。
**步骤：**

1. 方向：大柱面号，经过的请求：20, 35, 38, 70（到达 85）。
2. 反向移动，经过的请求：3, 2, 10。

**移动柱面数：**

| 顺序                                          | 从 → 到 | 距离 |
| :-------------------------------------------- | :------ | :--- |
| 1                                             | 15 → 20 | 5    |
| 2                                             | 20 → 35 | 15   |
| 3                                             | 35 → 38 | 3    |
| 4                                             | 38 → 70 | 32   |
| 5                                             | 70 → 85 | 15   |
| 6                                             | 85 → 3  | 82   |
| 7                                             | 3 → 2   | 1    |
| 8                                             | 2 → 10  | 8    |
| **总寻道距离：** 5+15+3+32+15+82+1+8=161 柱面 |         |      |
| **寻道时间：** 161×5=805ms                    |         |      |

------

### （4）CSCAN 算法（单向扫描）

**调度顺序：** 磁头向大柱面号移动到底（85），立即跳回最小柱面号（0）重新扫描。
**步骤：**

1. 方向：大柱面号，经过的请求：20, 35, 38, 70（到达 85）。
2. 跳回 0，重新扫描，经过的请求：2, 3, 10。

**移动柱面数：**

| 顺序                                            | 从 → 到 | 距离 |
| :---------------------------------------------- | :------ | :--- |
| 1                                               | 15 → 20 | 5    |
| 2                                               | 20 → 35 | 15   |
| 3                                               | 35 → 38 | 3    |
| 4                                               | 38 → 70 | 32   |
| 5                                               | 70 → 85 | 15   |
| 6                                               | 85 → 0  | 85   |
| 7                                               | 0 → 2   | 2    |
| 8                                               | 2 → 3   | 1    |
| 9                                               | 3 → 10  | 7    |
| **总寻道距离：** 5+15+3+32+15+85+2+1+7=165 柱面 |         |      |
| **寻道时间：** 165×5=825ms。                    |         |      |

------

### 总结

| 算法  | 总寻道距离（柱面） | 寻道时间（ms） |
| :---- | :----------------- | :------------- |
| FCFS  | 199                | 995            |
| SSTF  | 91                 | 455            |
| SCAN  | 161                | 805            |
| CSCAN | 165                | 825            |

**效率比较：** SSTF 最优，FCFS 最差。SCAN 和 CSCAN 适用于负载较高的场景。

2.

### I/O 缓冲区的主要目标

1. **缓解速度差异**：协调 CPU 处理速度与 I/O 设备速度的不匹配。
2. **减少中断频率**：通过批量传输降低设备中断次数。
3. **提高并行性**：允许 CPU 和 I/O 设备并行工作。
4. **避免数据丢失**：临时存储突发数据流。

------

### 单缓冲区下的时间计算

**操作流程（串行执行）：**

1. 读磁盘块到缓冲区：100μs
2. 缓冲区数据传用户区：50μs
3. CPU 分析数据：50μs

**每块总时间：** 100+50+50=200μs
**文件总时间（8块）：**

- 前7块：每块 200μs，共 7×200=1400μs
- 第8块：读入（100μs） + 传输（50μs） + 分析（50μs） = 200μs
- **总计：** 1400+200=1600μs

------

### 双缓冲区下的时间计算

**操作流程（并行执行）：**

- 缓冲区1和缓冲区2交替工作，允许重叠 I/O 和 CPU 处理。
- 关键：读磁盘块（100μs）与 CPU 分析（50μs）可并行。

**每块有效时间：**

- 读磁盘块（100μs）覆盖了传输（50μs） + 分析（50μs）。
- 因此，每块实际耗时由最慢操作（读磁盘块）决定：100μs

**文件总时间（8块）：**

- 前7块：每块 100μs，共 7×100=700μs
- 第8块：读入（100μs） + 传输（50μs，与第7块分析重叠） + 分析（50μs）
  - 最后 50μs 无法重叠，总增量：100μs
- **总计：** 700+100=800μs

------

### 结果对比

| 缓冲区类型 | 总时间（μs） |
| :--------- | :----------- |
| 单缓冲区   | 1600         |
| 双缓冲区   | 800          |

**结论：**
双缓冲区通过并行 I/O 和 CPU 处理，将时间减少一半。

3.

### RAID 0+1 数据丢失概率分析

#### 1. RAID 0+1 结构说明

- **总磁盘数**: 2n2*n* 块，分为两组（Group 1 和 Group 2），每组 n 块。
  - **Group 1**: Disk 1, Disk 2, ..., Disk n（数据条带化存储，RAID 0）
  - **Group 2**: Disk n+1, Disk n+2, ..., Disk 2n（Group 1 的镜像，RAID 1）
- **数据分布**: 数据先条带化写入 Group 1，再镜像到 Group 2。例如：
  - Group 1: A, B, C（条带化分布在 Disk 1, 2, 3）
  - Group 2: A, B, C（完全复制到 Disk 4, 5, 6）

#### 2. 数据丢失条件

- **单组完全失效**: 若 Group 1 或 Group 2 中所有磁盘故障，则数据丢失。
- **双磁盘故障场景**:
  - **Case 1**: 两块故障磁盘属于同一组（如 Disk 1 和 Disk 2）。
    - 若故障磁盘数 ≥ n（即同一组的全部磁盘），数据丢失。
    - 对于 n≥2，仅两块故障时，同一组最多损坏 2 块（未全损），数据不丢失。
  - **Case 2**: 两块故障磁盘分属不同组（如 Disk 1 和 Disk 4）。
    - 若两块磁盘在镜像位置（如 Disk 1 和 Disk 4 均存储数据 A），则数据 A 丢失。
    - 否则（如 Disk 1 和 Disk 5），数据仍可恢复。

#### 3. 概率计算（假设随机故障）

- **总故障组合数**:
  $C(2n,2)=\dfrac{2n×(2n−1)}{2}$
- **导致数据丢失的组合数**:
  - 同一组的两块磁盘故障：2×C(n,2)=n(n−1)
  - 不同组的镜像磁盘故障（如 Disk 1 和 Disk 4）：n对镜像，共 n种组合。
- **有效丢失组合数**: $n(n−1)+n=n^2$
- **数据丢失概率**:1/5

**答案**:
当 2n 块磁盘中有 2 块随机故障时，数据丢失的概率为 $\dfrac{1}{2n-1}$
对于题目中 n=3（6 块磁盘），概率为 $\dfrac{1}{5}$。

4.

### 提高文件系统性能的关键方面

------

#### 1. **磁盘调度算法优化**

- **目标**：减少磁头移动时间，提高I/O效率。
- **方法**：
  - 使用 **SSTF（最短寻道时间优先）** 或 **SCAN/C-SCAN（电梯算法）** 替代FCFS。
  - 针对SSD：采用 **FIFO** 或 **优先级调度**（无需磁头移动优化）。

#### 2. **缓存与缓冲区技术**

- **目标**：减少直接磁盘访问，缓解CPU与I/O速度差异。
- **方法**：
  - **磁盘缓存（Disk Caching）**：缓存频繁访问的磁盘块（如LRU算法）。
  - **双缓冲区（Double Buffering）**：允许I/O与CPU处理并行（如问题2中时间减半）。

#### 3. **文件分配策略改进**

- **目标**：减少文件碎片，提高连续访问速度。
- **方法**：
  - **连续分配**：适合大文件，减少寻道时间（但易产生外部碎片）。
  - **索引分配**：支持快速随机访问（如UNIX的inode）。
  - **集群分配（Block Clustering）**：将多个块合并分配，减少碎片。

#### 4. **目录结构优化**

- **目标**：加快文件检索速度。
- **方法**：
  - **哈希表目录**：O(1)时间复杂度查找文件。
  - **B+树目录**：支持高效范围查询（如NTFS、Ext4）。

#### 5. **预读（Read-Ahead）与延迟写（Lazy Writing）**

- **预读**：提前加载后续可能访问的数据块（如顺序读取文件）。
- **延迟写**：将写操作暂存缓冲区，合并后批量写入磁盘。

#### 6. **日志（Journaling）技术**

- **目标**：提高崩溃恢复速度，减少fsck时间。
- **方法**：
  - **元数据日志**（如Ext3）：仅记录元数据变更。
  - **全日志**（如Ext4）：记录所有数据变更，安全性更高。

#### 7. **RAID技术应用**

- **目标**：通过并行I/O提升吞吐量和容错性。
- **常用级别**：
  - **RAID 0**：条带化，提高速度（无冗余）。
  - **RAID 1**：镜像，提高可靠性。
  - **RAID 5/6**：条带化+分布式校验，平衡性能与安全。

#### 8. **减少磁盘碎片**

- **方法**：
  - **定期碎片整理**（如Windows Defragmenter）。
  - **动态分配策略**：优先分配连续空间（如Ext4的多块分配器）。

#### 9. **异步I/O与多线程**

- **目标**：重叠CPU与I/O操作。
- **方法**：
  - 使用异步I/O接口（如Linux的`io_uring`）。
  - 多线程处理文件请求（如数据库系统）。

#### 10. **文件系统压缩与去重**

- **压缩**：减少存储空间和传输量（如NTFS压缩）。
- **去重**：消除重复数据块（如ZFS）。

5.

#### 1. **文件基本信息**

- **文件名**：文件的唯一标识符（如`example.txt`）。
- **文件类型**：普通文件、目录、符号链接、设备文件等。
- **文件大小**：当前占用的存储空间（字节数）。
- **文件权限**：读/写/执行权限（如Unix的`rwxr-xr--`）。

#### 2. **文件位置信息**

- **物理存储地址**：
  - 连续分配：起始块地址和长度。
  - 链式分配：首块指针。
  - 索引分配：索引块地址（如inode中的块指针）。
- **磁盘块列表**：文件占用的具体磁盘块号（用于快速访问）。

#### 3. **时间戳**

- **创建时间**：文件生成的时间。
- **修改时间**：内容最后一次变更的时间。
- **访问时间**：最后一次被读取的时间。

#### 4. **所有者与权限**

- **用户ID（UID）**：文件所有者。
- **组ID（GID）**：所属用户组。
- **访问控制列表（ACL）**：细化权限管理（如Windows ACL）。

#### 5. **文件状态标志**

- **打开计数**：当前被进程打开的次数。
- **锁定状态**：是否被进程锁定（避免并发冲突）。
- **脏位（Dirty Bit）**：标记文件是否被修改未保存。

#### 6. **扩展属性（可选）**

- **文件系统特定信息**：如Ext4的扩展属性（exattr）。
- **校验和**：用于数据完整性验证（如ZFS）。

------

### FCB在不同系统中的实现

- **Unix/Linux的inode**：包含权限、大小、块指针等，但不存储文件名（由目录项管理）。
- **Windows的FCB**：直接关联文件名、安全描述符和存储位置。
- **FAT表的目录项**：简化版FCB，包含文件名、首簇号、属性字节。

**作用**：FCB是文件系统操作的基础，支持文件的创建、读写、权限控制和崩溃恢复。

6.

### 问题（1）：串联文件方式下的磁盘访问次数

**条件：**

- 目录结构：根目录 → 第二级目录（usr1/usr2/usr3） → 第三级目录（d0/d1/.../d127）。
- 文件组织：串联文件（链式分配），每个块包含指向下一个块的指针。
- 假设：根目录已在内存，目标文件在第三级目录下，其目录项可一次从磁盘读出。

**步骤分析：**

1. **访问第二级目录（usrX）**：
   - 需读取磁盘1次（从根目录找到第二级目录的物理块）。
2. **访问第三级目录（dY）**：
   - 需读取磁盘1次（从第二级目录找到第三级目录的物理块）。
3. **访问文件f的目录项**：
   - 已在假设中完成（无需额外磁盘访问）。
4. **访问文件f的数据块**：
   - 串联文件需顺序遍历块链，平均访问次数为文件块数的一半。
   - 文件平均大小100KB，每块1KB → 100块，平均需访问50次磁盘。

**总磁盘访问次数：**
1（第二级目录）+1（第三级目录）+50（文件块）=52次1（第二级目录）+1（第三级目录）+50（文件块）=52次。

------

### 问题（2）：i节点方式下的磁盘访问次数

**条件：**

- 目录结构：i节点组织，文件名占14B，i节点指针占2B。
- 第三级目录文件数≤50，根目录i节点已在内存。
- 仅直接索引（无间接块）。

**步骤分析：**

1. **访问第二级目录（usrX）**：
   - 需读取磁盘1次（从根目录i节点找到第二级目录的物理块）。
2. **访问第三级目录（dY）**：
   - 需读取磁盘1次（从第二级目录i节点找到第三级目录的物理块）。
3. **访问文件f的目录项**：
   - 目录项大小=14B（文件名）+2B（i节点指针）=16B。
   - 每块1KB可存 1024/16=641024/16=64 个目录项，50个文件仅需1块 → 读取磁盘1次。
4. **访问文件f的数据块**：
   - 直接索引指向数据块，访问任意块需1次磁盘读取。

**总磁盘访问次数：**
1（第二级目录）+1（第三级目录）+1（目录项）+1（数据块）=4次1（第二级目录）+1（第三级目录）+1（目录项）+1（数据块）=4次。

------

### 问题（3）：支持的最大文件大小

**条件：**

- 系统最大容量：16ZB（274274字节）。
- FCB索引区：512字节，采用一级索引。
- 块大小：1KB（210210字节）。

**计算步骤：**

1. **索引项大小**：
   - 每个索引项需指向一个块，假设指针占8B（支持264264地址空间）。
   - 512B索引区可存 512/8=64512/8=64 个索引项。
2. **直接索引块数**：64块。
3. **最大文件大小**：
   - 每块1KB，总大小 64×1KB=64KB64×1*K**B*=64*K**B*。

**问题与修正：**

- **矛盾点**：系统容量16ZB（需大地址空间），但一级索引仅支持64KB文件不合理。
- **正确理解**：题目可能指索引区本身占用512B，但实际指针应适应大容量。
  - 若块大小1KB，指针需至少74位（⌈log⁡2(16ZB/1KB)⌉=64⌈log2(16*ZB*/1*K**B*)⌉=64位），仍按8B/指针计算。
  - 最大文件仍为64KB（受限于一级索引设计）。

**结论：**
一级索引下，最大文件为 **64KB**。若题目允许多级索引，需重新计算（如二级索引支持64×64×1KB=4MB64×64×1*K**B*=4*MB*）。

------

### 最终答案

1. **串联文件方式**：平均访问磁盘 **52次**。
2. **i节点方式**：平均访问磁盘 **4次**。
3. **最大文件大小**：**64KB**（一级索引限制）。